<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
     <link
     href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.3/font/bootstrap-icons.min.css"
     rel="stylesheet"
   />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap">
    <link rel="icon" href="image/favicon.ico" type="image/x-icon">
    <title>Web Development PDF</title>
    <style>
      body {
        font-family: Georgia, 'Times New Roman', Times, serif;
        padding: 20px;
      }
      .pdf-container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        max-width: 800px;
        margin: auto;
      }
      .pdf-text {
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 5px;
        max-height: 400px;
        overflow-y: auto;
        font-size: 1.2rem;
        color: #333;
        line-height: 1.8;
        text-align: justify;
        position: relative;
      }
      .slider-container {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .custom-select-wrapper {
        position: relative;
        display: inline-block;
        width: 150px;
      }
      .background-image {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url("image/html_5.jpg");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        filter: brightness(0.6);
        z-index: -1;
      }
      /* Floating Chat Icon */
  .chat-icon {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 50%;
    padding: 15px;
    font-size: 24px;
    cursor: pointer;
    z-index: 1000;
  }
    </style>
  </head>
  <body>
    <div class="pdf-container">
      <div class="background-image"></div>
      <h2>Introduction to Web Development</h2>
      <p>
        This course provides an overview of HTML (Hypertext Markup Language).
        Explore the foundational elements that structure web pages, allowing you
        to create content for the web. Understand how mastering HTML forms the
        backbone of web development and contributes to building dynamic and
        interactive websites.
      </p>
      <div class="controls d-flex flex-wrap gap-2">
        <select
          id="languageSelect"
          class="form-select custom-select-wrapper"
          onchange="updateContent()"
        >
          <option value="English">English</option>
          <option value="French">French</option>
          <option value="Spanish">Spanish</option>
        </select>
        <select
          id="chapterSelect"
          class="form-select custom-select-wrapper"
          onchange="updateContent()"
        >
          <option value="Chapter1">Chapter 1</option>
          <option value="Chapter2">Chapter 2</option>
        </select>
        <select id="voiceSelect" class="form-select custom-select-wrapper"></select>
  
        <button class="btn btn-primary" onclick="startTTS()">Play Online</button>
        <button class="btn btn-secondary" onclick="pauseTTS()">Pause</button>
        <button class="btn btn-success" onclick="resumeTTS()">Resume</button>
        <button class="btn btn-danger" onclick="stopTTS()">Stop</button>
      </div>
  
      <!-- Progress Bar -->
      <div class="progress my-3" style="height: 20px;">
        <div
          id="progressBar"
          class="progress-bar progress-bar-striped bg-success"
          role="progressbar"
          style="width: 0%"
          aria-valuenow="0"
          aria-valuemin="0"
          aria-valuemax="100"
        ></div>
      </div>
  
      <div id="pdfViewer" class="pdf-text"></div>
      <audio id="audioPlayer" controls></audio>
  
      <a id="downloadPDF" class="btn btn-warning" download>Download PDF</a>
      <a id="downloadAudio" class="btn btn-info" download>Download Audio</a>
    </div>
  <!-- Mark AS Done -->
    <button class="btn btn-primary" id="markDoneBtn">Mark Lecture as Done</button>
     <!-- Floating Chat Icon -->
  <button class="chat-icon" id="chat-icon">
    <i class="fa fa-comment"></i>
  </button>
 <!-- Container for toast notifications -->
 <div id="toast-container" style="position: fixed; top: 20px; right: 20px; z-index: 1050;"></div>
    <script>
      let utterance;
      let speaking = false;
      let voices = [];
      let toastQueue = [];
      let showingToast = false;
  
      function updateContent() {
        const language = document.getElementById("languageSelect").value;
        const chapter = document.getElementById("chapterSelect").value;
  
        const pdfPath = `documents/${chapter}${
          chapter === "Chapter2" ? "_BuildingBlocks" : "_IntroductionToHTML"
        }${language !== "English" ? "_" + language : ""}.pdf`;
        const audioPath = `audio/HTML_Lesson1_${language}.mp3`;
  
        loadPDF(pdfPath);
        document.getElementById("audioPlayer").src = audioPath;
        document.getElementById("downloadPDF").href = pdfPath;
        document.getElementById("downloadAudio").href = audioPath;
      }
  
      async function loadPDF(pdfFile) {
        const pdfViewer = document.getElementById("pdfViewer");
        pdfViewer.innerHTML = "";
        try {
          const pdf = await pdfjsLib.getDocument(pdfFile).promise;
          let text = "";
          for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const textContent = await page.getTextContent();
            const pageText = textContent.items
              .map((item) => item.str)
              .join(" ");
            text += `Page ${i}:\n${pageText}\n\n`;
          }
          pdfViewer.textContent = text;
        } catch (error) {
          pdfViewer.textContent = "Error loading PDF";
        }
      }
  
      function startTTS() {
        if (speaking) return;
        const text = document.getElementById("pdfViewer").textContent;
        utterance = new SpeechSynthesisUtterance(text);
        utterance.voice = voices.find(
          (voice) => voice.name === document.getElementById("voiceSelect").value
        );
  
        // Update the progress bar based on current word index
        utterance.onboundary = (event) => {
          const progress = Math.min(
            Math.floor((event.charIndex / text.length) * 100),
            100
          );
          document.getElementById("progressBar").style.width = `${progress}%`;
        };
  
        utterance.onend = () => {
          enqueueToast("Speech finished", "bg-primary", "check-circle");
          document.getElementById("progressBar").style.width = "0%"; // Reset progress bar
        };
  
        speechSynthesis.speak(utterance);
        speaking = true;
      }
  
      function pauseTTS() {
        speechSynthesis.pause();
        enqueueToast("Speech paused", "bg-warning", "pause-circle");
      }
  
      function resumeTTS() {
        speechSynthesis.resume();
        enqueueToast("Speech resumed", "bg-info", "play-circle");
      }
  
      function stopTTS() {
        speechSynthesis.cancel();
        speaking = false;
        enqueueToast("Speech stopped", "bg-danger", "stop-circle");
        document.getElementById("progressBar").style.width = "0%"; // Reset progress bar
      }
  
      // Toast Queue System
      function enqueueToast(message, className, icon) {
        toastQueue.push({ message, className, icon });
        if (!showingToast) {
          dequeueToast();
        }
      }
  
      function dequeueToast() {
        if (toastQueue.length === 0) return;
        showingToast = true;
        const { message, className, icon } = toastQueue.shift();
        showToast(message, className, icon);
      }
  
      function showToast(message, className, icon) {
        const toast = document.createElement("div");
        toast.className = `toast align-items-center text-white ${className} fade show border-0`;
        toast.style = "position: absolute; top: 20px; right: 20px; z-index: 1050;";
        toast.innerHTML = `
          <div class="d-flex">
            <div class="toast-body">
              <i class="bi bi-${icon} me-2"></i> <!-- Add icon here -->
              ${message}
            </div>
          </div>
        `;
        document.body.appendChild(toast);
  
        const bsToast = new bootstrap.Toast(toast, { delay: 3000, autohide: true });
        bsToast.show();
  
        toast.addEventListener("hidden.bs.toast", () => {
          toast.remove();
          showingToast = false;
          dequeueToast();
        });
      }
  
      speechSynthesis.onvoiceschanged = () => {
        voices = speechSynthesis.getVoices();
        document.getElementById("voiceSelect").innerHTML = voices
          .map((voice) => `<option value="${voice.name}">${voice.name}</option>`)
          .join("");
      };
  
      document.addEventListener("DOMContentLoaded", updateContent);

      // Toast function to show a Bootstrap toast
      function showToast(message, className, icon) {
        let toastContainer = document.getElementById("toast-container");
        if (!toastContainer) {
          toastContainer = document.createElement("div");
          toastContainer.id = "toast-container";
          toastContainer.style.position = "fixed";
          toastContainer.style.top = "20px";
          toastContainer.style.right = "20px";
          toastContainer.style.zIndex = "1050";
          document.body.appendChild(toastContainer);
        }

        const toast = document.createElement("div");
        toast.className =
          "toast align-items-center text-white " +
          className +
          " fade show border-0";
        toast.setAttribute("role", "alert");
        toast.innerHTML = `
          <div class="d-flex">
            <div class="toast-body">
              <i class="bi bi-${icon} me-2"></i> ${message}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto"
                    data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
        `;

        toastContainer.appendChild(toast);
        const bsToast = new bootstrap.Toast(toast, { delay: 3000 });
        bsToast.show();

        toast.addEventListener("hidden.bs.toast", () => toast.remove());
      }

      // Event listener for the "Mark Lecture as Done" button
      document.getElementById("markDoneBtn").addEventListener("click", function () {
        const courseId = "course-1";
        const totalLectures = 11;
        let completedLectures = parseInt(localStorage.getItem(courseId)) || 0;

        if (completedLectures < totalLectures) {
          completedLectures++;
          localStorage.setItem(courseId, completedLectures);

          // If this page is opened within an iframe or a child window,
          // send the updated progress to the parent page:
          if (window.parent) {
            window.parent.postMessage(
              { courseId: courseId, completedLectures: completedLectures },
              "*"
            );
          }

          // Show success toast on the lecture page
          showToast("Lecture marked as done! Progress saved.", "bg-success", "check-circle");
        } else {
          showToast("All lectures completed!", "bg-warning", "exclamation-circle");
        }
      });
    </script>
  </body>
</html>
