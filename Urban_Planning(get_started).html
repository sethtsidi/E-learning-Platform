<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <title>PDF Audio Converter with Voice Options</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script src="https://code.responsivevoice.org/responsivevoice.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }

      .background-image {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url("/image/urban.jpg");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        filter: brightness(0.6);
        z-index: -1;
      }

      .pdf-container {
        background-color: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
        max-width: 800px;
        margin: auto;
      }

      .highlight {
        background-color: yellow;
        color: black;
      }

      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .pdf-text {
        background-color: #fff;
        padding: 20px;
        border-radius: 5px;
        max-height: 400px;
        overflow-y: auto;
        font-size: 1.1rem;
        color: #333;
      }

      .slider-container {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .custom-select-wrapper {
        position: relative;
        display: inline-block;
        width: 200px; /* Adjust the width as needed */
      }

      .form-select {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        background-color: #f9f9f9; /* Light background */
        border: 1px solid #ddd; /* Subtle border */
        border-radius: 8px; /* Rounded corners */
        padding: 10px 40px 10px 12px; /* Add padding */
        font-size: 16px; /* Adjust font size */
        font-family: inherit;
        color: #333; /* Text color */
        width: 100%;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .form-select:hover {
        border-color: #007bff; /* Highlight on hover */
        background-color: #fff;
        box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1); /* Add shadow */
      }

      .form-select:focus {
        border-color: #007bff;
        outline: none;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25); /* Bootstrap focus effect */
      }

      /* Add a dropdown arrow */
      .form-select::after {
        content: '';
        position: absolute;
        top: 50%;
        right: 12px;
        width: 8px;
        height: 8px;
        background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMCIgaGVpZ2h0PSI2IiB2aWV3Qm94PSIwIDAgMTAgNiI+PHBhdGggZD0iTSAwLjUgMCA1IDUgOSAweiIgZmlsbD0iI2RkZCIvPjwvc3ZnPg==') no-repeat;
        transform: translateY(-50%);
        pointer-events: none;
      }
    </style>
  </head>

  <body>
    <div class="background-image"></div>
    <div class="pdf-container">
      <h2>Introduction to Urban Planning</h2>
      <p>
        Convert this PDF to audio and follow along as it highlights the words
        being read aloud.
      </p>

      <!-- Controls -->
      <div class="controls">
        <button class="btn btn-danger" id="playBtn" onclick="startReading()">Play</button>
        <button class="btn btn-secondary" id="pauseBtn" onclick="pauseReading()">Pause</button>
        <button class="btn btn-info" id="resumeBtn" onclick="resumeReading()">Resume</button>
        <button class="btn btn-warning" id="skipBackBtn" onclick="skipBack()">Skip Backward 5s</button>
        <button class="btn btn-warning" id="skipForwardBtn" onclick="skipForward()">Skip Forward 5s</button>
        <div class="slider-container">
          <label for="speedSlider">Speed: </label>
          <input
            type="range"
            id="speedSlider"
            min="0.5"
            max="2"
            step="0.1"
            value="1"
            oninput="adjustSpeed()"
          />
        </div>
        <div class="slider-container">
          <label for="voiceSelect" class="form-label">Voice:</label>
          <div class="custom-select-wrapper">
            <select id="voiceSelect" class="form-select">
              <option value="US English Female">US English Female</option>
              <option value="UK English Male">UK English Male</option>
              <option value="US English Male">US English Male</option>
              <option value="UK English Female">UK English Female</option>
            </select>
          </div>
        </div>
        <a
          href="documents/Intership Report on both Field and In_Person.pdf"
          download
          class="btn btn-primary"
        >
          Download PDF
        </a>
      </div>

      <!-- PDF Content Display -->
      <div id="pdfViewer" class="pdf-text"></div>
    </div>

    <script>
      let pdfFile = "documents/Intership Report on both Field and In_Person.pdf";
      let currentWordIndex = 0;
      let wordArray = [];
      let fullText = "";
      let speaking = false;
      let speechRate = 1;
      let isPaused = false;

      // Load and parse PDF
      async function loadPdf() {
        const pdf = await pdfjsLib.getDocument(pdfFile).promise;
        fullText = "";

        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const textContent = await page.getTextContent();
          const pageText = textContent.items.map((item) => item.str).join(" ");
          fullText += pageText + " ";
        }

        wordArray = fullText.split(/\s+/);
        displayText();
      }

      function displayText() {
        const pdfViewer = document.getElementById("pdfViewer");
        pdfViewer.innerHTML = wordArray.join(" ");
      }

      function highlightWord() {
        const pdfViewer = document.getElementById("pdfViewer");
        pdfViewer.innerHTML = "";

        wordArray.forEach((word, index) => {
          const span = document.createElement("span");
          span.textContent = word + " ";
          if (index === currentWordIndex) span.classList.add("highlight");
          pdfViewer.appendChild(span);
        });
      }

      function startReading() {
        const selectedVoice = document.getElementById("voiceSelect").value;
        if (!speaking) {
          speaking = true;
          responsiveVoice.speak(fullText, selectedVoice, {
            rate: speechRate,
            onstart: () => {
              isPaused = false;
              highlightCurrentWord();
            },
            onend: () => {
              speaking = false;
              currentWordIndex = 0;
            },
          });
        }
      }

      function pauseReading() {
        responsiveVoice.pause();
        isPaused = true;
        speaking = false;
      }

      function resumeReading() {
        if (isPaused) {
          responsiveVoice.resume();
          speaking = true;
          isPaused = false;
        }
      }

      function adjustSpeed() {
        speechRate = document.getElementById("speedSlider").value;
        if (speaking) {
          responsiveVoice.cancel();
          startReading();
        }
      }

      function highlightCurrentWord() {
        if (speaking) {
          highlightWord();
          currentWordIndex++;
          setTimeout(() => {
            if (currentWordIndex < wordArray.length) highlightCurrentWord();
          }, 500 / speechRate);
        }
      }

      function skipBack() {
        currentWordIndex = Math.max(currentWordIndex - 5, 0);
        highlightCurrentWord();
      }

      function skipForward() {
        currentWordIndex = Math.min(currentWordIndex + 5, wordArray.length - 1);
        highlightCurrentWord();
      }

      window.onload = loadPdf;
    </script>
  </body>
</html>
